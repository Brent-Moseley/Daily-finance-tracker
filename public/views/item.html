<!-- public/views/item.html -->
<!-- Foundation Cheat Sheet:  https://princessdesign.net/foundation-cheat-sheet/ -->

<div class="panel content large-8 medium-10 small-12 small-centered large-centered radius" 
     style="padding: 0.75rem;">
  <h1>Recent Expense History:</h1>
  <p>{{ tagline }}<br>
  You are logged in as: {{login}}</p>
 
  
  <div class="row">
    <div class="small-6 medium-6 large-6 columns">
       <input type="checkbox" ng-model="showDateRange" /> Filter by New Date Range
    </div>
    <div class="small-6 medium-6 large-6 columns">
      <div ng-show="viewStartDate != 'none'">View Range: {{viewStartDate}} to {{viewEndDate}}</div>
    </div>
  </div>  
  <div id="show-block" ng-show="showDateRange" class="panel">
    <div class="row">
      <div class="small-6 medium-2 large-2 columns">
        Start Date:
      </div>
      <div class="small-7 medium-3 large-3 columns">
        <input class="calendar" type="text" ng-model="startDate" ui-date="dateOptions"/>
      </div>
      <div class="small-6 medium-2 large-2 columns">
        End Date:
      </div>
      <div class="small-7 medium-3 large-3 columns">
        <input class="calendar" type="text" ng-model="endDate" ui-date="dateOptions"/>
      </div>
      <div class="small-7 medium-2 large-2 columns">
        <a ng-show="!updatingDates" ng-click="dateFilter(startDate, endDate)" class="button postfix show">Show</a>
        <img ng-show="updatingDates" src="images/loading-1.gif" />
      </div>
      <div class="small-5 show-for-small columns">
      </div>
    </div>
  </div>
  <img ng-show="mainTableLoading" src="images/loading-1.gif" />
  <table>
    <!-- Table for larger devices, create a smaller one for small devices that omits remove and notes -->
    <thead>
      <tr>
        <th width="120" class="hand-clickable" ng-click="columnSort('date');">Date</th>
        <th width="100" class="hand-clickable" ng-click="columnSort('category');">Category</th> 
        <th width="100" class="hand-clickable" ng-click="columnSortNum('cost');">Cost</th>
        <th class="hide-for-small" width="350">Notes</th>
        <th class="hide-for-small" width="50">Remove</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="item in items track by $index">
        <!-- <td>{{item.date}}</td> -->
        <td>
          <input class="calendar" type="text" ng-model="item.date" ui-date="dateOptions" grid="true"/> 
        </td>
        <td>
          <select ng-model="item.category" ng-change="update(item._id, item)">
            <option ng-repeat="option in categories">{{option}}</option>
          </select>
        </td>
        <!-- <td>{{item.cost}}</td> -->
         <td>
          <input type="text" ng-model="item.cost" filter-element="numberCurrency" ng-change="updateNote(item._id, $index, true)" class="line-input">
        </td>     
        <td class="hide-for-small">
          <input type="text" ng-model="item.note" ng-change="updateNote(item._id, $index, false)" class="line-input">
        </td>

        <td class="text-center hide-for-small"><a href="" ng-click="requestedDelete(item.note, item._id)">X</a>
        </td>
      </tr>
    </tbody>
  </table>
  Add a new expense (enter dollar value, then add details above):<br>
  <div class="row">
    <div class="large-10 columns">
      <div class="row collapse">
        <div class="small-10 medium-8 large-8 columns">
          <input type="text" placeholder="New cost" filter-element="numberCurrency" ng-model="newOne">
        </div>
        <div class="small-2 medium-4 large-4 columns">
          <a ng-show="!loadingAdd" id="add-button" ng-click="addOne(newOne)"class="button postfix">Add</a>
          <img ng-show="loadingAdd" src="images/loading-1.gif" />
        </div>
      </div>
    </div>
  </div> 
  <div id="page-total" class="row panel">
    <div class="small-3 medium-3 large-3 columns">
      Page Total:
    </div>
    <div class="small-3 medium-3 large-3 columns">
      {{viewTotal | currency}} 
    </div>
    <div class="small-6 medium-6 large-6 columns">
    </div>    
  </div>

  <div id="cat-total" class="row panel">
    <div class="small-3 medium-3 large-3 columns hide-for-small">
      Category Total this Page:
    </div>
    <div class="small-5 medium-3 large-3 columns">
      <select ng-model="selectedCat" ng-change="calculateCatTotal(selectedCat)">
        <option ng-repeat="option in categories">{{option}}</option>
      </select>
    </div>
    <div class="small-1 medium-2 large-2 columns">
      {{catTotal | currency}}
    </div> 
    <div class="small-4 medium-4 large-4 columns">
      <a ng-show="!loadingCategories" ng-click="openCategoryPopup();" id="category-button" class="button postfix" style="width: 7rem;">Category Limits</a>
      <img ng-show="loadingCategories" src="images/loading-1.gif" />
    </div>       
  </div>             

  <!-- DELETE CONFIRMATION POPUP, MAKE INTO DIRECTIVE LATER, CUSTOM MESSAGES, ONE DIRECTIVE FOR ALL DELETE CONFIRMATIONS -->
  <div id="deleteModal" class="reveal-modal small" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h3 id="modalTitle">Confirm Delete:</h3>
    Are you sure you want to delete this expense? {{deleteItemNote}}
     <p>
      <div class="row">
        <div class="small-4 medium-4 large-4 columns">
          <a ng-click="closeDeletePopup();"class="button postfix" style="width: 7rem;">Cancel</a>
        </div>
        <div class="small-4 medium-4 large-4 columns">
        </div>        
        <div class="small-4 medium-4 large-4 columns">
          <a ng-show="!deleting" ng-click="confirmedDelete();"class="button postfix" style="width: 7rem;">Delete</a>
          <img ng-show="deleting" src="images/loading-1.gif" />
        </div>     
      </div>
    </p> 
  </div>  

 <!-- DELETE CONFIRMATION POPUP, MAKE INTO DIRECTIVE LATER, CUSTOM MESSAGES, ONE DIRECTIVE FOR ALL DELETE CONFIRMATIONS -->
  <div id="deleteCategoryModal" class="reveal-modal small" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h3 id="modalTitle">Confirm Delete:</h3>
    Are you sure you want to delete this category? {{deleteCategoryNote}}<br>
    You cannot undo this later.
     <p>
      <div class="row">
        <div class="small-4 medium-4 large-4 columns">
          <a ng-click="closeCatDeletePopup();"class="button postfix" style="width: 7rem;">Cancel</a>
        </div>
        <div class="small-4 medium-4 large-4 columns">
        </div>        
        <div class="small-4 medium-4 large-4 columns">
          <a ng-show="!deleting" ng-click="removeCategory();"class="button postfix" style="width: 7rem;">Delete</a>
          <img ng-show="deleting" src="images/loading-1.gif" />
        </div>     
      </div>
    </p> 
  </div> 

  <!-- CATEGORY POPUP, MAKE INTO DIRECTIVE LATER -->
  <div id="categoryModal" class="reveal-modal medium" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h3 id="modalTitle">Categories</h3>
    Shows your totals for the current month in each category, and is color coded to show how close you are to your budget limit.
    <table>
      <th width="120">Category Name</th>
      <th width="100">Monthly Limit</th> 
      <th width="100">Current Month Total</th>
      <th width="50" class="hide-for-small">Remove</th>
      <tr ng-repeat="category in modalCategories track by $index">
        <!-- <td>{{item.date}}</td> -->
        <td>
          {{category.name}}
        </td>
        <td>
          <input type="text" ng-model="category.limit" filter-element="numberCurrency" class="line-input" ng-blur="updateCategory(category)"/>
        </td>
        <td ng-class="category.highlight">
          {{category.currentTotal | currency}}
        </td>
        <td class="text-center hide-for-small"><a href="" ng-click="openCatDeleteConfirm(category._id)">X</a></td>
  </tr>
    </table>
   
    <p>
      <div class="row">
        <div class="small-2 medium-3 large-3 columns">
          <a ng-show="!recalcCategories" ng-click="addCategory();"class="button postfix" style="width: 7rem;">Add</a>
          <img ng-show="recalcCategories" src="images/loading-1.gif" />
        </div>
        <div class="small-2 medium-3 large-3 columns">
          <a ng-click="closeCategoryPopup();"class="button postfix" style="width: 7rem;">Close</a>
        </div>
        <div class="small-8 medium-6 large-6 columns">
        </div>        
      </div>
    </p>

    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
  </div></div>

<!--  I am awesome and I am going to rock this!! -->